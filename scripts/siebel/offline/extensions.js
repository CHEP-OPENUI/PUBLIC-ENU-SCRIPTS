/*<ORACLECOPYRIGHT>
* Copyright (C) 1994-2013 Oracle and/or its affiliates. All rights reserved.
* Oracle and Java are registered trademarks of Oracle and/or its affiliates.
* Other names may be trademarks of their respective owners.
* UNIX is a registered trademark of The Open Group.
*
* This software and related documentation are provided under a license agreement
* containing restrictions on use and disclosure and are protected by intellectual property laws.
* Except as expressly permitted in your license agreement or allowed by law, you may not use, copy,
* reproduce, translate, broadcast, modify, license, transmit, distribute, exhibit, perform, publish,
* or display any part, in any form, or by any means. Reverse engineering, disassembly,
* or decompilation of this software, unless required by law for interoperability, is prohibited.
*
* The information contained herein is subject to change without notice and is not warranted to be error-free.
* If you find any errors, please report them to us in writing.
*
* U.S. GOVERNMENT RIGHTS Programs, software, databases, and related documentation and technical data delivered to U.S.
* Government customers are "commercial computer software" or "commercial technical data" pursuant to the applicable
* Federal Acquisition Regulation and agency-specific supplemental regulations.
* As such, the use, duplication, disclosure, modification, and adaptation shall be subject to the restrictions and
* license terms set forth in the applicable Government contract, and, to the extent applicable by the terms of the
* Government contract, the additional rights set forth in FAR 52.227-19, Commercial Computer Software License
* (December 2007). Oracle America, Inc., 500 Oracle Parkway, Redwood City, CA 94065.
*
* This software or hardware is developed for general use in a variety of information management applications.
* It is not developed or intended for use in any inherently dangerous applications, including applications that
* may create a risk of personal injury. If you use this software or hardware in dangerous applications,
* then you shall be responsible to take all appropriate fail-safe, backup, redundancy,
* and other measures to ensure its safe use. Oracle Corporation and its affiliates disclaim any liability for any
* damages caused by use of this software or hardware in dangerous applications.
*
* This software or hardware and documentation may provide access to or information on content,
* products, and services from third parties. Oracle Corporation and its affiliates are not responsible for and
* expressly disclaim all warranties of any kind with respect to third-party content, products, and services.
* Oracle Corporation and its affiliates will not be responsible for any loss, costs,
* or damages incurred due to your access to or use of third-party content, products, or services.
</ORACLECOPYRIGHT>*/
if(typeof(SiebelApp.AjaxRequestMgr)){(function(){var b=SiebelApp.AjaxRequestMgr.constructor;var k=SiebelJS.Dependency("SiebelApp.Utils");var i=SiebelApp.OfflineAppSettings;var c=SiebelApp.Offlineconstants;var g=SiebelApp.OfflineUtils;var f=[];var j=null;var d=window.location;var n=d.origin.concat(d.pathname);var e=true;var a={};if(i.GetMode()){if(d.href===n||!(navigator.onLine)){if(!i.GetUpSyncStatus()){var m=JSON.parse(window.localStorage.getItem("StringCache"));if(m){SiebelApp.S_App.SetStringCache(m)}}}else{i.SetUpSyncStatus(true)}}b.prototype.ProcessToolbarResponse=function(s){var y="";if(this.data){y=this.data}else{if(this.url){y=this.url}}if(!y){return}var w;var t={};if(IsOfflineModeEnabled()&&(y.search("SWECmd=Go+")!==-1)&&(y.search("Offline")!==-1)){var p=CCFMiscUtil_CreatePropSet();p.DecodeFromString(s);w=SiebelApp.OfflineAppMgr.CheckValidation(p);if(w){var r;var v;if(p.GetType()!=="offpkg"){r="IDS_DOUI_ERR_OFFLINE_PKG_SRVR";v=SiebelApp.S_App.OfflineLocaleObject.GetLocalString(r);alert(v);SiebelApp.OfflineUtils.CcfLogEvent([c.get("LOG_EVT_METADATA_EX"),19,3,6]);$(".progressbar").remove();SiebelApp.S_App.CustomToolbar.Update("FullDownLoadFailed");t.bContinue=false;return t}var u=p.GetChildCount();var q=p.GetProperty("Status");var x=p.GetValue();if(q==="Error"||(!u&&x!=="nochng")){r="IDS_DOUI_ERR_METADATA_SRVR";SiebelApp.OfflineUtils.CcfLogEvent([c.get("LOG_EVT_METADATA_EX"),17,3,6]);v=SiebelApp.S_App.OfflineLocaleObject.GetLocalString(r);alert(v);$(".progressbar").remove();SiebelApp.S_App.CustomToolbar.Update("FullDownLoadFailed");t.bContinue=false;return t}if(x==="new"){t.bContinue=true;if(k.IsEmpty(p.GetProperty("SyncNodeId"))||k.IsEmpty(p.GetProperty("srfid"))){r="IDS_DOUI_ERR_METADATA_SRVR";SiebelApp.OfflineUtils.CcfLogEvent([c.get("LOG_EVT_METADATA_EX"),18,3,6]);v=SiebelApp.S_App.OfflineLocaleObject.GetLocalString(r);alert(v);$(".progressbar").remove();SiebelApp.S_App.CustomToolbar.Update("FullDownLoadFailed");t.bContinue=false;return t}SiebelApp.BrowserCacheMgr.CacheSyncNodeId(p.GetProperty("SyncNodeId"));SiebelApp.BrowserCacheMgr.CacheSRFId(p.GetProperty("srfid"));t.args=[p];t.callback=function(z){SiebelApp.SyncMgr.LoadOfflinePackage(z,false)};return t}if(x==="nochng"){t.bContinue=true;t.args=[];t.callback=function(){i.OnSuccessfulMetaDataDownload();SiebelApp.ProactiveCacheBuilder.ClearDataTables(false)}}}else{t.bContinue=false}return t}if(IsOfflineModeEnabled()&&y.search("SWECmd=GetOfflineData")!==-1){var o=CCFMiscUtil_CreatePropSet();o.DecodeFromString(s);w=SiebelApp.OfflineAppMgr.CheckValidation(o);if(w){$.callback(this,function(){var z=function(){if(i.GetMetadata()){SiebelApp.OfflineUtils.CcfLogEvent([c.get("LOG_EVT_DATA_EX_BASIC"),15,3,6]);$(".progressbar").find("img").removeClass().addClass("offlineDataEnd");SiebelApp.SyncMgr.LoadOfflinePackage(o,true,s)}else{$.callback(this,function(){z.call(this)})}};z.call(this)})}else{return false}}};b.prototype.SetSrvrReqInputProp=function(s,z,t,v,y){var r=s;var x=SiebelApp.Constants;if(!k.IsEmpty(s)&&!k.IsEmpty(z)&&t){var p=t.length;var u=z.length;if(p===u){var o=k.DecodeFromQueryString(s);for(var q=0;q<u;q++){var w=o.GetProperty(z[q]);if(k.IsEmpty(w)||w!==t[q]){o.SetProperty(z[q],t[q])}}r=k.EncodeToQueryString(o,false);if(k.IsEmpty(y)){r=SiebelApp.S_App.GetPageURL()+x.get("SWE_ARG_START")+r}else{r=y+x.get("SWE_ARG_START")+r}}}return r};b.prototype.Get=function(o,q){var p={};p.url=o;p.type="GET";p.async=true;p.successfncallback=q;this.Ajax(p)};b.prototype.Post=function(o,q){var p={};p.successfncallback=q;this.Ajax(p)};b.prototype.SetDepnRequestMap=function(o){a=o};b.prototype.GetDepnRequestMap=function(o){return a[o]};b.prototype.SetActiveRequest=function(o,p){j=o;e=p};b.prototype.GetRequestQueue=function(){return f};b.prototype.GetActiveRequest=function(){return j};b.prototype.IsActiveRequestAsync=function(){return e};b.prototype.ClearActiveRequest=function(){return f.shift()};b.prototype.GetActiveRequestObj=function(){var p=this.GetActiveRequest();if(p){var o=p.url;if(p.data){o+="?"+p.data}o=g.JsonRecordSet(o);if(p.activeControl){o.activeControl=p.activeControl}return o}else{return null}};b.prototype.CanExecuteCurrRequest=function(x,o,y,z){var A={};var p;var u;if(y||!SiebelApp.RequestProcessor.IsSupported(z,false,this.GetActiveRequest())){return true}if(!o&&!o.SweCommands&&!o.SweCommands.SWEMethod){return false}else{p=o.SweCommands.SWEMethod}A=this.GetDepnRequestMap(p);var q=x.length;for(var s=0;s<q;s++){var v=x[s];var r=v.url;if(v.data){r+="?"+v.data}v=g.JsonRecordSet(r);if(!v&&!v.SweCommands&&!v.SweCommands.SWEMethod){return false}else{u=v.SweCommands.SWEMethod}if(SiebelApp.RequestProcessor.IsCUDRequest(u)){return true}if(A){var w=A.length;if(w>0){for(var t=0;t<w;t++){if(A[t]===u){return true}}}}}return false};function l(p,o){$.ajaxSetup({cache:"true"});$.ajax({url:p.url,data:p.data,type:p.type,async:p.async,contentType:p.contentType,success:function(v,w,u){var q=[];q.push(v);q.push(w);q.push(u);if(SiebelApp.OfflineUtils.IsValidServerResponse(v)){var t=k.DecodeFromQueryString(o);var s=t.GetPropertyAsStr("SWECmd");if(s===c.get("GOTOVIEW")){if(SiebelApp.S_App.GetUserName()===SiebelApp.S_App.Model.GetLoginName()){i.SetUpSyncStatus(false);var r=JSON.parse(window.localStorage.getItem("StringCache"));SiebelApp.S_App.CustomToolbar.Update("UpSyncDone");if(r){SiebelApp.S_App.SetStringCache(r)}if(i.GetUpSyncStatus()){i.SetUpSyncStatus(false)}SiebelApp.AjaxRequestMgr.Ajax(p)}else{i.SetMode(false,true);i.SetUpSyncStatus(false)}}else{if(SiebelApp.RequestProcessor.IsSupported(t,true,p)){p.successfncallback.apply(p.context||this,q)}}}else{i.SetUpSyncStatus(false);this.Ajax(p)}},error:p.errfncb,context:p.context,complete:function(q,s,r){if(s==="error"){i.SetUpSyncStatus(false);this.Ajax(p)}}})}function h(p,o){$.ajaxSetup({cache:"true"});$.ajax({url:p.url,data:p.data,type:p.type,async:p.async,contentType:p.contentType,success:function(v,x,u){if(d.href===n){var t=k.DecodeFromQueryString(o);var s=t.GetProperty("SWECmd").toString();if(s==="GetCachedFrame"){var w=t.GetProperty("SWEFrame").toString();if(w==="top._swe"){if(SiebelApp.OfflineAppMgr.CheckServerConnection(v)){var r=d.pathname;r=r.concat("?SWENeedContext=false&SWECmd=Logoff&SWEBID=-1&SRN=&SWETS=");Top().location.replace(r);return}else{if(i.GetPkgStatus()){i.OnSuccessfulDataDownload();d.replace(d.origin.concat(d.pathname))}}}}}var q=[];q.push(v);q.push(x);q.push(u);if(SiebelApp.OfflineUtils.IsValidServerResponse(v)){SiebelApp.OfflineAppMgr.CacheResponse(o,q);p.successfncallback.apply(p.context||this,q)}else{SiebelApp.OfflineUtils.CcfLogEvent([c.get("LOG_EVT_ALL"),20,3,7,o,v])}},error:p.errfncb,complete:function(s,v,t){if(v==="error"){var r=k.DecodeFromQueryString(o);var q=r.GetProperty("SWECmd").toString();if(q==="GetCachedFrame"){var u=r.GetProperty("SWEFrame").toString();if(u==="top._swe"){if(i.GetPkgStatus()){i.OnSuccessfulDataDownload();d.replace(d.origin.concat(d.pathname))}}}}}})}b.prototype.Ajax=function(s,r){var p=s.url;if(s.data){p+="?"+s.data}if(i.GetUpSyncStatus()&&navigator.onLine){l.call(this,s,p);
return}if(i.CheckOfflineMode()&&(r!==false)&&(SiebelApp.OfflineAppMgr.IsCachableRequest(p))&&!i.GetMode()){h.call(this,s,p);return}else{if(i.GetMode()&&SiebelApp.OfflineAppMgr.IsCachableRequest(p)){if(!this.GetActiveRequest()){this.SetActiveRequest(s,s.async);SiebelApp.OfflineAppMgr.OfflineRequestHandler(p,s,s.async);$.callback(this,function(){var t=this.IsActiveRequestAsync();var v=this.GetActiveRequestObj();this.SetActiveRequest(null);var u=this.GetRequestQueue();if(u.length>0&&(this.CanExecuteCurrRequest(u,v,t,p))){this.Ajax(this.ClearActiveRequest())}else{f=[]}})}else{if(!SiebelApp.OfflineAppMgr.CheckResolvedState()){var o=SiebelApp.S_App.GetActiveView();if(o){var q=o.GetActiveApplet();if(o&&q&&q.GetActiveControl()){s.activeControl=q.GetActiveControl()}}f.push(s)}else{this.SetActiveRequest(null);f.push(s);this.Ajax(this.ClearActiveRequest())}}}else{$.ajax({url:s.url,data:s.data,type:s.type,async:s.async,contentType:s.contentType,success:s.successfncallback,error:s.errfncb,context:s.context})}}}}())}if(typeof(SiebelApp.OfflineExtensions)==="undefined"){Namespace("SiebelApp.OfflineExtensions");SiebelApp.OfflineExtensions=(function(){SiebelApp.S_App.constructor.prototype.OfflineCallMethod=function(){if(IsOfflineModeEnabled()){c.call(this,arguments)}};function c(f){var e=f[0];switch(e){case"ProcessAppletSelfProps":a.call(this,f);break;case"AddFieldName":d.call(this,f);break;case"ReplaceShortURL":b.call(this,f);break;default:break}}function a(g){if(SiebelApp.OfflineAppSettings.GetMode()){var f=g[1];var e=f.GetView();var h=e?e.GetActiveApplet():null;if(h){var i=h.GetActiveControl();if(i&&i.GetUIType()==="Pick"){var j={};j.SrcApplet=h.GetName();j.SrcAppletFld=i.GetFieldName();f.GetPickAppletSrcInfo=function(){return j}}}}}function d(l){if(SiebelApp.OfflineAppSettings.GetMode()){var i="OF_";var g=l[1];var h=l[2];var e=l[3];var f=l[4];var m=g.GetControls();var j=m[e];var k=j.GetFieldName();if((g.IsInQueryMode())||(j.GetCtrlFldEncode())){h.SetProperty(i+k,f)}else{h.SetProperty(i+k,g.GetFieldValue(j))}}}function b(g){var f=window.applicationCache;if(f.status!==1||(SiebelApp.OfflineAppSettings.GetMode())){var i=g[1];var e=g[2];var h="start.swe";History.pushState(null,null,h)}}}())};